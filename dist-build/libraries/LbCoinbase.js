var _0x700f=['bignumber.js','config','./LbBlockchain','./../models/BtcTransaction','./../models/EthTransaction','numeral','client','accounts','isCheckSend','key','secret','getAccounts','log','length','currency','__IniMemberBalance','__UpdateDeposit','getAccountTransaction','BTC','first','rest','network','hash','TransactionInfo','out','forEach','push','addr','findOne','getTicker','amount','price_usd','create','syswallet','_id','deposit','TXID:\x20','findById','balance','plus','statistics','ETH','result','address','valueOf','update','__CreateMemberInvestment','findAllQ','sendMoney','type','value','updateQ','Withdraw\x20to:\x20','feeamount','Hash:\x20','toString','try','memberid','from','withdraw.','minus','deleteQ','getAccountDeposit','getAccount','getDeposits','getTransactions','format','0.00000000','getAddress','floor','random','getAddresses','getListAddress','createAddress','getCurrency','coinbase','Client','Member','./../models/MemberStatistics','./../models/Deposit','./../models/Withdraw','./LbCoinmarketcap','underscore'];(function(_0x1a6a7e,_0x10be75){var _0x4cf796=function(_0x1b5b65){while(--_0x1b5b65){_0x1a6a7e['push'](_0x1a6a7e['shift']());}};_0x4cf796(++_0x10be75);}(_0x700f,0x197));var _0xf700=function(_0x4429df,_0x19ba92){_0x4429df=_0x4429df-0x0;var _0x1349a1=_0x700f[_0x4429df];return _0x1349a1;};'use strict';var Client=require(_0xf700('0x0'))[_0xf700('0x1')];const Config=require('./../config/config');const All=require('./../models/All');var Member=new All(_0xf700('0x2'));const MemberBalance=require('./../models/MemberBalance');const MemberStatistics=require(_0xf700('0x3'));const Deposit=require(_0xf700('0x4'));const Withdraw=require(_0xf700('0x5'));const LbCoinmarketcap=require(_0xf700('0x6'));var _=require(_0xf700('0x7'));var bigNumber=require(_0xf700('0x8'));bigNumber[_0xf700('0x9')]({'DECIMAL_PLACES':0x8,'ERRORS':![],'ROUNDING_MODE':0x1});const LbEtherscan=require('./LbEtherscan');const LbBlockchain=require(_0xf700('0xa'));const BtcTransaction=require(_0xf700('0xb'));const EthTransaction=require(_0xf700('0xc'));const numeral=require(_0xf700('0xd'));var trim=require('trim');class LbCoinbase{constructor(){this[_0xf700('0xe')]=![];this[_0xf700('0xf')]=![];this[_0xf700('0x10')]=![];let _0x4eb352=this;this[_0xf700('0xe')]=new Client({'apiKey':Config[_0xf700('0x0')][_0xf700('0x11')],'apiSecret':Config['coinbase'][_0xf700('0x12')]});let _0x431455=()=>{_0x4eb352['client'][_0xf700('0x13')]({},function(_0x3fe172,_0xc096d4){console[_0xf700('0x14')](_0x3fe172);console[_0xf700('0x14')](_0xc096d4);if(!_0xc096d4||!_0xc096d4[_0xf700('0x15')]){return setTimeout(()=>{_0x431455();},0x2710);}let _0x3c5d77={};for(let _0x184eab=0x0;_0x184eab<_0xc096d4[_0xf700('0x15')];_0x184eab++){_0x3c5d77[_0xc096d4[_0x184eab][_0xf700('0x16')]]=_0xc096d4[_0x184eab];}_0x4eb352[_0xf700('0xf')]=_0x3c5d77;});};_0x431455();setInterval(()=>{this[_0xf700('0x17')]();},0x7530);setInterval(()=>{this[_0xf700('0x18')]();},0x7530);}[_0xf700('0x18')](){this[_0xf700('0x19')](_0xf700('0x1a'),_0xcb8651=>{if(_0xcb8651&&_0xcb8651[_0xf700('0x15')]){let _0x49abca=_0x2d4d1f=>{if(_0x2d4d1f&&_0x2d4d1f[_0xf700('0x15')]){let _0x106a77=_[_0xf700('0x1b')](_0x2d4d1f);let _0x50b91b=()=>{setTimeout(()=>{_0x49abca(_[_0xf700('0x1c')](_0x2d4d1f));},0x3e8);};if(!_0x106a77||!_0x106a77[_0xf700('0x1d')]||!_0x106a77[_0xf700('0x1d')]['hash']){return _0x50b91b();}Deposit['findOne']({'hash':_0x106a77[_0xf700('0x1d')][_0xf700('0x1e')]},(_0x5acc0b,_0x3b2f8d)=>{if(!_0x3b2f8d){LbBlockchain[_0xf700('0x1f')](_0x106a77['network']['hash'],_0x115e38=>{if(_0x115e38&&_0x115e38[_0xf700('0x20')]){let _0x4dd5ec=[];_0x115e38[_0xf700('0x20')][_0xf700('0x21')](_0x68cb0=>{_0x4dd5ec[_0xf700('0x22')]({'syswallet.BTC.address':new RegExp('^'+_0x68cb0[_0xf700('0x23')]+'$','i')});});Member[_0xf700('0x24')]({'$or':_0x4dd5ec},(_0x31bdf0,_0xf1ad07)=>{if(_0xf1ad07){LbCoinmarketcap[_0xf700('0x25')](_0x47f89c=>{let _0x362af4=+_0x106a77[_0xf700('0x26')]['amount']*+_0x47f89c['BTC'][_0xf700('0x27')];Deposit[_0xf700('0x28')]({'memberid':_0xf1ad07['_id'],'amount':_0x362af4,'value':+_0x106a77[_0xf700('0x26')][_0xf700('0x26')],'type':'BTC','hash':_0x106a77['network']['hash'],'address':_0xf1ad07[_0xf700('0x29')][_0xf700('0x1a')]['address'],'active':!![]},(_0x511420,_0x5820a5)=>{BtcTransaction['create']({'address':_0xf1ad07[_0xf700('0x29')]['BTC']['address'],'member':_0xf1ad07[_0xf700('0x2a')],'type':_0xf700('0x2b'),'to':_0xf700('0x1a'),'foreignKey':_0x5820a5[_0xf700('0x2a')],'description':_0xf700('0x2c')+_0x106a77[_0xf700('0x1d')][_0xf700('0x1e')],'amount':+_0x106a77[_0xf700('0x26')][_0xf700('0x26')]},()=>{});MemberBalance[_0xf700('0x2d')](_0xf1ad07[_0xf700('0x2e')],(_0x21ecd1,_0x2f47cf)=>{MemberBalance['update'](_0x2f47cf[_0xf700('0x2a')],{'BTC':new bigNumber(_0x2f47cf[_0xf700('0x1a')])[_0xf700('0x2f')](_0x106a77[_0xf700('0x26')][_0xf700('0x26')])['valueOf']()},()=>{MemberStatistics['findById'](_0xf1ad07[_0xf700('0x30')],(_0xe80177,_0x53936e)=>{MemberStatistics['update'](_0x53936e['_id'],{'balance.BTC':new bigNumber(_0x2f47cf[_0xf700('0x1a')])['plus'](_0x106a77[_0xf700('0x26')][_0xf700('0x26')])['valueOf']()},()=>{});});});});});});}});}});}_0x50b91b();});}};_0x49abca(_0xcb8651);}});this[_0xf700('0x19')](_0xf700('0x31'),_0x485a80=>{if(_0x485a80&&_0x485a80[_0xf700('0x15')]){let _0x53c800=_0x323956=>{if(_0x323956&&_0x323956[_0xf700('0x15')]){let _0x362fc0=_[_0xf700('0x1b')](_0x323956);let _0x5d5739=()=>{setTimeout(()=>{_0x53c800(_['rest'](_0x323956));},0x64);};if(!_0x362fc0||!_0x362fc0[_0xf700('0x1d')]||!_0x362fc0[_0xf700('0x1d')][_0xf700('0x1e')]){return _0x5d5739();}Deposit[_0xf700('0x24')]({'hash':_0x362fc0[_0xf700('0x1d')][_0xf700('0x1e')]},(_0x21770e,_0x2bfd87)=>{if(!_0x2bfd87){LbEtherscan[_0xf700('0x1f')](_0x362fc0[_0xf700('0x1d')][_0xf700('0x1e')],_0x1ac739=>{if(_0x1ac739&&_0x1ac739[_0xf700('0x32')]){Member[_0xf700('0x24')]({'syswallet.ETH.address':new RegExp('^'+_0x1ac739['result']['to']+'$','i')},(_0xfd6679,_0x44b1ef)=>{if(_0x44b1ef){LbCoinmarketcap[_0xf700('0x25')](_0x3092cf=>{let _0x58be20=+_0x362fc0[_0xf700('0x26')][_0xf700('0x26')]*+_0x3092cf[_0xf700('0x31')][_0xf700('0x27')];Deposit[_0xf700('0x28')]({'memberid':_0x44b1ef['_id'],'amount':_0x58be20,'value':+_0x362fc0[_0xf700('0x26')][_0xf700('0x26')],'type':'ETH','hash':_0x362fc0[_0xf700('0x1d')]['hash'],'address':_0x44b1ef[_0xf700('0x29')][_0xf700('0x31')][_0xf700('0x33')],'active':!![]},(_0x23afeb,_0x59eb36)=>{EthTransaction['create']({'address':_0x44b1ef[_0xf700('0x29')][_0xf700('0x31')]['address'],'member':_0x44b1ef[_0xf700('0x2a')],'type':_0xf700('0x2b'),'to':_0xf700('0x31'),'foreignKey':_0x59eb36[_0xf700('0x2a')],'description':'TXID:\x20'+_0x362fc0[_0xf700('0x1d')][_0xf700('0x1e')],'amount':+_0x362fc0['amount']['amount']},()=>{});MemberBalance[_0xf700('0x2d')](_0x44b1ef[_0xf700('0x2e')],(_0x43bb9d,_0xb6d3a5)=>{MemberBalance['update'](_0xb6d3a5[_0xf700('0x2a')],{'ETH':new bigNumber(_0xb6d3a5[_0xf700('0x31')]||0x0)[_0xf700('0x2f')](_0x362fc0['amount'][_0xf700('0x26')])[_0xf700('0x34')]()},()=>{MemberStatistics['findById'](_0x44b1ef[_0xf700('0x30')],(_0x211930,_0x50ca2d)=>{MemberStatistics[_0xf700('0x35')](_0x50ca2d[_0xf700('0x2a')],{'balance.ETH':new bigNumber(_0xb6d3a5[_0xf700('0x31')])[_0xf700('0x2f')](_0x362fc0[_0xf700('0x26')]['amount'])[_0xf700('0x34')]()},()=>{});});});});});});}else{_0x5d5739();}});}else{_0x5d5739();}});}else{_0x5d5739();}});}else{}};_0x53c800(_0x485a80);}else{}});}[_0xf700('0x36')](_0x1a1ea5,_0x26fa97){}[_0xf700('0x17')](){let _0x57f63a=this;if(!_0x57f63a['isCheckSend']){_0x57f63a[_0xf700('0x10')]=!![];Withdraw[_0xf700('0x37')]({'memconfirm':!![],'cancel':![],'success':![],'adminconfirm':!![],'$or':[{'type':_0xf700('0x1a')},{'type':_0xf700('0x31')}]},(_0x4afb55,_0x1af867)=>{let _0x6dc1e2=_0xcc10ed=>{if(_0xcc10ed&&_0xcc10ed[_0xf700('0x15')]){let _0x5c9113=_[_0xf700('0x1b')](_0xcc10ed);this[_0xf700('0x38')](_0x5c9113[_0xf700('0x33')],_0x5c9113[_0xf700('0x39')],_0x5c9113[_0xf700('0x3a')],'System\x20'+_0x5c9113['type'],(_0x32dfbe,_0x569302)=>{if(_0x32dfbe){if(_0x5c9113[_0xf700('0x39')]==_0xf700('0x1a')){BtcTransaction[_0xf700('0x3b')]({'foreignKey':_0x5c9113[_0xf700('0x2a')]},{'description':_0x32dfbe&&_0x32dfbe[_0xf700('0x1d')]&&_0x32dfbe[_0xf700('0x1d')][_0xf700('0x1e')]?'Hash:\x20'+_0x32dfbe[_0xf700('0x1d')][_0xf700('0x1e')]:_0xf700('0x3c')+_0x5c9113[_0xf700('0x33')]+'<br\x20/>Fee:\x20'+_0x5c9113[_0xf700('0x3d')]},()=>{});}else{EthTransaction[_0xf700('0x3b')]({'foreignKey':_0x5c9113['_id']},{'description':_0x32dfbe&&_0x32dfbe['network']&&_0x32dfbe['network'][_0xf700('0x1e')]?_0xf700('0x3e')+_0x32dfbe[_0xf700('0x1d')][_0xf700('0x1e')]:_0xf700('0x3c')+_0x5c9113[_0xf700('0x33')]+'<br\x20/>Fee:\x20'+_0x5c9113['feeamount']},()=>{});}Withdraw[_0xf700('0x35')](_0x5c9113[_0xf700('0x2a')],{'success':!![],'tx':_0x32dfbe[_0xf700('0x1d')]},()=>{setTimeout(()=>{_0x6dc1e2(_[_0xf700('0x1c')](_0xcc10ed));},0x7d0);});}else{Withdraw[_0xf700('0x35')](_0x5c9113[_0xf700('0x2a')],{'description':_0x569302[_0xf700('0x3f')]()},()=>{});if(_0x5c9113[_0xf700('0x40')]>=0x3){Member[_0xf700('0x2d')](_0x5c9113[_0xf700('0x41')],(_0x534f4d,_0x11b2cb)=>{if(_0x11b2cb){MemberBalance['findById'](_0x11b2cb[_0xf700('0x2e')],(_0x1163ee,_0x1a1025)=>{let _0x4b0dbc={};_0x4b0dbc[_0x5c9113[_0xf700('0x42')]]=new bigNumber(_0x5c9113['amount'])['plus'](_0x1a1025[_0x5c9113['from']]);MemberBalance[_0xf700('0x35')](_0x11b2cb[_0xf700('0x2e')],_0x4b0dbc,()=>{MemberStatistics[_0xf700('0x2d')](_0x11b2cb['statistics'],(_0x413848,_0x527fb8)=>{let _0x18da33={};_0x18da33[_0xf700('0x43')+_0x5c9113['from']]=new bigNumber(_0x527fb8['withdraw'][_0x5c9113[_0xf700('0x42')]])[_0xf700('0x44')](_0x5c9113[_0xf700('0x26')]);MemberStatistics[_0xf700('0x35')](_0x11b2cb[_0xf700('0x30')],_0x18da33,()=>{setTimeout(()=>{_0x6dc1e2(_[_0xf700('0x1c')](_0xcc10ed));},0x3e8);});});});});}else{setTimeout(()=>{_0x6dc1e2(_[_0xf700('0x1c')](_0xcc10ed));},0x3e8);}});if(_0x5c9113[_0xf700('0x39')]=='BTC'){BtcTransaction[_0xf700('0x45')]({'foreignKey':_0x5c9113['_id']},()=>{});}else{EthTransaction[_0xf700('0x45')]({'foreignKey':_0x5c9113[_0xf700('0x2a')]},()=>{});}Withdraw[_0xf700('0x35')](_0x5c9113[_0xf700('0x2a')],{'cancel':!![],'description':'Transaction\x20can\x27t\x20be\x20executed','code':''},()=>{});}else{Withdraw['update'](_0x5c9113[_0xf700('0x2a')],{'try':_0x5c9113['try']+0x1},()=>{setTimeout(()=>{_0x6dc1e2(_[_0xf700('0x1c')](_0xcc10ed));},0x3e8);});}}},_0x5c9113[_0xf700('0x2a')]);}else{_0x57f63a['isCheckSend']=![];}};_0x6dc1e2(_0x1af867);});}}[_0xf700('0x46')](_0x3566a5,_0x4deffb){this[_0xf700('0x47')](_0x3566a5,_0x558c60=>{_0x558c60[_0xf700('0x48')]({},(_0x198d99,_0x454667)=>{_0x4deffb(_0x454667);});});}['getAccountTransaction'](_0x53d266,_0x40b64d){this[_0xf700('0x47')](_0x53d266,_0xe00aa4=>{_0xe00aa4[_0xf700('0x49')]({},(_0x52bc42,_0x3b1dff)=>{_0x40b64d(_0x3b1dff);});});}[_0xf700('0x38')](_0x23396e,_0x22d721,_0x568254,_0x1a6288,_0x1aa98b,_0x130044){this[_0xf700('0x47')](_0x22d721,_0x4908d0=>{_0x4908d0[_0xf700('0x38')]({'to':_0x23396e,'amount':numeral(_0x568254)[_0xf700('0x4a')](_0xf700('0x4b')),'currency':_0x22d721,'description':_0x1a6288,'to_financial_institution':!![],'idem':_0x130044,'financial_institution_website':'coinbase.com'},function(_0x382bb3,_0x409eaf){if(!_0x382bb3){_0x1aa98b(_0x409eaf);}else{_0x1aa98b(![],_0x382bb3);}});});}[_0xf700('0x49')](_0x525424,_0x44aa11,_0x4075c0){let _0x7f7445=this;this[_0xf700('0x4c')](_0x525424,_0x44aa11,_0x506493=>{if(_0x506493){_0x506493[_0xf700('0x49')]({},(_0x11a8c0,_0x46abb4)=>{_0x4075c0(_0x46abb4);});}else{setTimeout(()=>{_0x7f7445[_0xf700('0x49')](_0x525424,_0x44aa11,_0x4075c0);},Math[_0xf700('0x4d')](Math['random']()*0x64)+0x32);}});}[_0xf700('0x4c')](_0x5bb4c5,_0x570de0,_0x3decdc){let _0x412467=this;this[_0xf700('0x47')](_0x5bb4c5,_0x59e6ac=>{if(_0x59e6ac){_0x59e6ac[_0xf700('0x4c')](_0x570de0,(_0x2ccb1e,_0x58dc97)=>{_0x3decdc(_0x58dc97);});}else{setTimeout(()=>{_0x412467[_0xf700('0x4c')](_0x5bb4c5,_0x570de0,_0x3decdc);},Math['floor'](Math[_0xf700('0x4e')]()*0x64)+0x32);}});}[_0xf700('0x4f')](_0x1f58ff,_0x97bfe4){let _0x33d34e=this;this[_0xf700('0x47')](_0x1f58ff,_0x1d751e=>{if(_0x1d751e){let _0x3e54cc=()=>{_0x1d751e[_0xf700('0x4f')]({},(_0x27b7ae,_0x3f81c4)=>{if(!_0x27b7ae)_0x97bfe4(_0x3f81c4);else{setTimeout(()=>{_0x3e54cc();},Math[_0xf700('0x4d')](Math['random']()*0x64)+0x32);}});};_0x3e54cc();}else{setTimeout(()=>{_0x33d34e[_0xf700('0x4f')](_0x1f58ff,_0x97bfe4);},Math[_0xf700('0x4d')](Math[_0xf700('0x4e')]()*0x64)+0x32);}});}[_0xf700('0x50')](_0x3aeae7,_0x136c61){let _0xdcb63e=this;this[_0xf700('0x47')](_0x3aeae7,_0x26c274=>{if(_0x26c274){_0x26c274[_0xf700('0x4f')]({},(_0x6554da,_0x460da4)=>{_0x136c61(_0x460da4);});}else{setTimeout(()=>{_0xdcb63e[_0xf700('0x50')](_0x3aeae7,_0x136c61);},Math[_0xf700('0x4d')](Math['random']()*0x64)+0x32);}});}[_0xf700('0x51')](_0x22d989,_0x3bc8b7,_0x3e3e1b){let _0x564748=this;this[_0xf700('0x47')](_0x22d989,_0x379ae8=>{if(_0x379ae8){let _0x31847e=()=>{_0x379ae8[_0xf700('0x51')](_0x3bc8b7,function(_0x5bc123,_0x4720ae){if(!_0x4720ae){setTimeout(()=>{_0x31847e();},Math[_0xf700('0x4d')](Math[_0xf700('0x4e')]()*0x64)+0x32);}else _0x3e3e1b(_0x4720ae);});};_0x31847e();}else{setTimeout(()=>{_0x564748[_0xf700('0x51')](_0x22d989,_0x3bc8b7,_0x3e3e1b);},Math[_0xf700('0x4d')](Math['random']()*0x64)+0x32);}});}[_0xf700('0x47')](_0x2f13aa,_0x39e838){let _0x46966f=this;this[_0xf700('0x52')](_0x2f13aa,_0x3ca610=>{if(_0x3ca610){let _0x4e5ce3=()=>{_0x46966f[_0xf700('0xe')][_0xf700('0x47')](_0x3ca610['id'],(_0xfe0c33,_0x3e08cf)=>{if(_0x3e08cf){_0x39e838(_0x3e08cf);}else{setTimeout(()=>{_0x4e5ce3();},Math[_0xf700('0x4d')](Math[_0xf700('0x4e')]()*0x64)+0x32);}});};_0x4e5ce3();}else{setTimeout(()=>{_0x46966f['getAccount'](_0x2f13aa,_0x39e838);},Math[_0xf700('0x4d')](Math[_0xf700('0x4e')]()*0x64)+0x32);}});}[_0xf700('0x52')](_0x35fae5,_0x5f2e88){if(this[_0xf700('0xf')]){_0x5f2e88(this[_0xf700('0xf')][_0x35fae5]);}else{setTimeout(()=>{this[_0xf700('0x52')](_0x35fae5,_0x5f2e88);});}}}module['exports']=new LbCoinbase();