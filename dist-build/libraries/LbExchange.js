var _0xc7c9=['getTicker','create','price_usd','times','emit','market-history','__IniExchangeSell','__SendExchangeInfo','update-exchange','findAllQ','length','minus','__IniSellAction','__IniBuyAction','sendToMember','member','do-update-info','findOne','address','update','_id','totalSend','balance','totalReceived','first','rest','min','do-update-open-orders','findById','coin','Buy\x20SVC:<br\x20/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20UNITS\x20TOTAL\x20SVC:\x20','format',',\x20UNITS\x20FILLED\x20SVC:\x20',',\x20PRICE:\x20','0,0.00000000',',\x20TOTAL\x20BTC:\x20',',\x20FEES\x20BTC:\x20','exchange','buy','coinwallet','exchange_buy_coin_success','Exchange:\x20BUY\x20SVC','statistics','sell','fee','exchange_sell_coin_success','IniBuySuccess','__UpdateExchange','cancel','exchange_sell_coin_cancel','Exchange:\x20Cancel\x20Sell\x20SVC','cancel_sell','Cancel\x20Sell\x20SVC:<br\x20/>\x0a\x20\x20\x20\x20UNITS\x20TOTAL\x20SVC:\x20','totalAmount','Exchange:\x20Cancel\x20Buy\x20SVC','Sell\x20SVC:<br\x20/>\x0aUNITS\x20TOTAL\x20SVC:\x20','exchange_buy_coin','Exchange:\x20Buy\x20SVC','exchange_sell_coin','Exchange:\x20Sell\x20SVC','exports','./../models/Exchange','./../models/Member','./../models/MemberBalance','./../models/MemberStatistics','./../models/BtcTransaction','./../models/CoinTransaction','./LbCoinmarketcap','./LbSocket','underscore','numeral','bignumber.js','config','./../models/WalletAddress','listExchange','isIniExchange','BTC','forEach','plus','type','Sells','rate','amount','totalRemaining','valueOf','Buys','__IniExchange','__IniExchangeBuy'];(function(_0x466936,_0x22eb6c){var _0x4f045f=function(_0x506db9){while(--_0x506db9){_0x466936['push'](_0x466936['shift']());}};_0x4f045f(++_0x22eb6c);}(_0xc7c9,0x19d));var _0x9c7c=function(_0x14ca0b,_0x1b05ff){_0x14ca0b=_0x14ca0b-0x0;var _0x48619e=_0xc7c9[_0x14ca0b];return _0x48619e;};'use strict';const Exchange=require(_0x9c7c('0x0'));const Member=require(_0x9c7c('0x1'));const MemberBalance=require(_0x9c7c('0x2'));const MemberStatistics=require(_0x9c7c('0x3'));const BtcTransaction=require(_0x9c7c('0x4'));const WalletTransaction=require('./../models/WalletTransaction');const ExchangeHistory=require('./../models/ExchangeHistory');const Config=require('./../config/config');const CoinTransaction=require(_0x9c7c('0x5'));var LbExchangeHistory=require('./LbExchangeHistory');const LbCoinmarketcap=require(_0x9c7c('0x6'));const LbSocket=require(_0x9c7c('0x7'));var _=require(_0x9c7c('0x8'));const numeral=require(_0x9c7c('0x9'));var bigNumber=require(_0x9c7c('0xa'));bigNumber[_0x9c7c('0xb')]({'DECIMAL_PLACES':0x8,'ERRORS':![],'ROUNDING_MODE':0x1});const Tx=require('./../models/Tx');const WalletAddress=require(_0x9c7c('0xc'));class LbExchange{constructor(){this[_0x9c7c('0xd')]={'Sells':{},'Buys':{}};this[_0x9c7c('0xe')]=![];Exchange['findAllQ']({'success':![],'cancel':![],'market':_0x9c7c('0xf')},(_0x2fc7d0,_0x494661)=>{_0x494661[_0x9c7c('0x10')](_0x3bd661=>{this[_0x9c7c('0x11')](_0x3bd661);});},0x98967f,0x0,{'rate':-0x1});}['EmitItem'](_0xfac5ee,_0x227d77,_0x125a53){}[_0x9c7c('0x11')](_0x4dc56d,_0x33701f=![]){if(_0x4dc56d[_0x9c7c('0x12')]=='S'){if(this['listExchange']['Sells'][_0x4dc56d['rate']]){this[_0x9c7c('0xd')][_0x9c7c('0x13')][_0x4dc56d[_0x9c7c('0x14')]][_0x9c7c('0x15')]=new bigNumber(this[_0x9c7c('0xd')][_0x9c7c('0x13')][_0x4dc56d[_0x9c7c('0x14')]][_0x9c7c('0x15')])['plus'](_0x4dc56d[_0x9c7c('0x16')])[_0x9c7c('0x17')]();}else{this[_0x9c7c('0xd')][_0x9c7c('0x13')][_0x4dc56d[_0x9c7c('0x14')]]={'amount':_0x4dc56d[_0x9c7c('0x16')],'rate':_0x4dc56d[_0x9c7c('0x14')]};}}else{if(this[_0x9c7c('0xd')][_0x9c7c('0x18')][_0x4dc56d['rate']]){this['listExchange'][_0x9c7c('0x18')][_0x4dc56d[_0x9c7c('0x14')]][_0x9c7c('0x15')]=new bigNumber(this[_0x9c7c('0xd')][_0x9c7c('0x18')][_0x4dc56d[_0x9c7c('0x14')]][_0x9c7c('0x15')])[_0x9c7c('0x11')](_0x4dc56d[_0x9c7c('0x16')])[_0x9c7c('0x17')]();}else{this[_0x9c7c('0xd')][_0x9c7c('0x18')][_0x4dc56d[_0x9c7c('0x14')]]={'amount':_0x4dc56d['totalRemaining'],'rate':_0x4dc56d[_0x9c7c('0x14')]};}}this['__SendExchangeInfo'](_0x4dc56d);if(_0x33701f){this['EmitItem'](_0x4dc56d['type'],_0x4dc56d[_0x9c7c('0x14')],this[_0x9c7c('0xd')][_0x4dc56d[_0x9c7c('0x12')]=='S'?'Sells':'Buys'][_0x4dc56d['rate']][_0x9c7c('0x15')]);this['__IniExchange'](_0x4dc56d);}}[_0x9c7c('0x19')](_0x4e4267){if(this['isIniExchange']){setTimeout(()=>{this[_0x9c7c('0x19')](_0x4e4267);},0x64);return;}this[_0x9c7c('0xe')]=!![];if(_0x4e4267[_0x9c7c('0x12')]=='B'){this[_0x9c7c('0x1a')](_0x4e4267,_0x4d879d=>{if(_0x4d879d){LbCoinmarketcap[_0x9c7c('0x1b')](_0x149b73=>{ExchangeHistory[_0x9c7c('0x1c')]({'amount':_0x4d879d,'rate':_0x4e4267[_0x9c7c('0x14')],'type':_0x4e4267[_0x9c7c('0x12')],'market':_0x9c7c('0xf'),'usd':new bigNumber(_0x149b73[_0x9c7c('0xf')][_0x9c7c('0x1d')])[_0x9c7c('0x1e')](_0x4e4267[_0x9c7c('0x14')])},(_0x307d2b,_0x5ba134)=>{if(_0x5ba134)LbSocket['io'][_0x9c7c('0x1f')](_0x9c7c('0x20'),_0x5ba134);this[_0x9c7c('0xe')]=![];});});}else{this['isIniExchange']=![];}});}else{this[_0x9c7c('0x21')](_0x4e4267,_0x21dc9b=>{if(_0x21dc9b){LbCoinmarketcap[_0x9c7c('0x1b')](_0x55154f=>{ExchangeHistory[_0x9c7c('0x1c')]({'amount':_0x21dc9b,'rate':_0x4e4267[_0x9c7c('0x14')],'market':'BTC','type':_0x4e4267[_0x9c7c('0x12')],'usd':new bigNumber(_0x55154f[_0x9c7c('0xf')]['price_usd'])['times'](_0x4e4267[_0x9c7c('0x14')])},(_0x2a5938,_0x1001ad)=>{if(_0x1001ad)LbSocket['io'][_0x9c7c('0x1f')](_0x9c7c('0x20'),_0x1001ad);this[_0x9c7c('0xe')]=![];});});}else{this[_0x9c7c('0xe')]=![];}});}}[_0x9c7c('0x22')](_0x2db0d1,_0x28425a=![]){if(_0x28425a)LbSocket['io'][_0x9c7c('0x1f')](_0x9c7c('0x20'),_0x28425a);if(this['listExchange']['Sells'][_0x2db0d1['rate']]&&this[_0x9c7c('0xd')][_0x9c7c('0x13')][_0x2db0d1[_0x9c7c('0x14')]]['amount']<=0x0){delete this[_0x9c7c('0xd')]['Sells'][_0x2db0d1[_0x9c7c('0x14')]];}if(this[_0x9c7c('0xd')]['Buys'][_0x2db0d1[_0x9c7c('0x14')]]&&this[_0x9c7c('0xd')][_0x9c7c('0x18')][_0x2db0d1[_0x9c7c('0x14')]][_0x9c7c('0x15')]<=0x0){delete this['listExchange'][_0x9c7c('0x18')][_0x2db0d1[_0x9c7c('0x14')]];}LbSocket['io']['emit'](_0x9c7c('0x23'),{'amount':this[_0x9c7c('0xd')][_0x9c7c('0x13')][_0x2db0d1[_0x9c7c('0x14')]]?this[_0x9c7c('0xd')][_0x9c7c('0x13')][_0x2db0d1['rate']][_0x9c7c('0x15')]:0x0,'rate':_0x2db0d1[_0x9c7c('0x14')],'type':_0x9c7c('0x13')});LbSocket['io'][_0x9c7c('0x1f')](_0x9c7c('0x23'),{'amount':this['listExchange']['Buys'][_0x2db0d1[_0x9c7c('0x14')]]?this[_0x9c7c('0xd')][_0x9c7c('0x18')][_0x2db0d1[_0x9c7c('0x14')]][_0x9c7c('0x15')]:0x0,'rate':_0x2db0d1[_0x9c7c('0x14')],'type':_0x9c7c('0x18')});}[_0x9c7c('0x21')](_0x1a9e8f,_0x2d7ba1){Exchange[_0x9c7c('0x24')]({'success':![],'cancel':![],'market':'BTC','type':'B','$or':[{'rate':_0x1a9e8f['rate']},{'rate':{'$gte':_0x1a9e8f['rate']}}]},(_0x47f27c,_0x39a8f9)=>{let _0x1fc220=0x0;let _0x5870e4=_0x1fc5eb=>{if(_0x1fc5eb&&_0x1fc5eb[_0x9c7c('0x25')]&&_0x1fc220<_0x1a9e8f[_0x9c7c('0x16')]){let _0x2c8a7a=_['first'](_0x1fc5eb);let _0x35e24a=()=>{_0x5870e4(_['rest'](_0x1fc5eb));};let _0x1751a5=Math['min'](new bigNumber(_0x1a9e8f['totalRemaining'])[_0x9c7c('0x26')](_0x1fc220)[_0x9c7c('0x17')](),_0x2c8a7a[_0x9c7c('0x16')]);this[_0x9c7c('0x27')](_0x1a9e8f,_0x1751a5,()=>{if(this[_0x9c7c('0xd')][_0x9c7c('0x13')][_0x1a9e8f[_0x9c7c('0x14')]]){this[_0x9c7c('0xd')][_0x9c7c('0x13')][_0x1a9e8f['rate']][_0x9c7c('0x15')]=new bigNumber(this['listExchange'][_0x9c7c('0x13')][_0x1a9e8f[_0x9c7c('0x14')]][_0x9c7c('0x15')])[_0x9c7c('0x26')](_0x1751a5);this['__SendExchangeInfo'](_0x1a9e8f);}this[_0x9c7c('0x28')](_0x2c8a7a,_0x1751a5,()=>{if(this['listExchange'][_0x9c7c('0x18')][_0x2c8a7a[_0x9c7c('0x14')]]){this[_0x9c7c('0xd')][_0x9c7c('0x18')][_0x2c8a7a['rate']][_0x9c7c('0x15')]=new bigNumber(this[_0x9c7c('0xd')]['Buys'][_0x2c8a7a[_0x9c7c('0x14')]][_0x9c7c('0x15')])[_0x9c7c('0x26')](_0x1751a5);this['__SendExchangeInfo'](_0x2c8a7a);}LbSocket[_0x9c7c('0x29')](_0x2c8a7a[_0x9c7c('0x2a')],_0x9c7c('0x2b'),{'update':!![]});_0x1fc220=new bigNumber(_0x1751a5)[_0x9c7c('0x11')](_0x1fc220)[_0x9c7c('0x17')]();WalletAddress['findOne']({'member':_0x2c8a7a[_0x9c7c('0x2a')]},(_0x15341e,_0x255869)=>{WalletAddress[_0x9c7c('0x2c')]({'member':_0x1a9e8f[_0x9c7c('0x2a')]},(_0x2c2c98,_0x30ab0c)=>{Tx[_0x9c7c('0x1c')]({'from':_0x30ab0c[_0x9c7c('0x2d')],'to':_0x255869[_0x9c7c('0x2d')],'amount':_0x1fc220,'status':0x1},()=>{WalletAddress[_0x9c7c('0x2e')](_0x255869[_0x9c7c('0x2f')],{'balance':new bigNumber(_0x255869['balance'])[_0x9c7c('0x11')](_0x1fc220),'totalReceived':new bigNumber(_0x255869[_0x9c7c('0x30')])[_0x9c7c('0x11')](_0x1fc220)},(_0x542c33,_0xaed381)=>{WalletAddress[_0x9c7c('0x2e')](_0x30ab0c[_0x9c7c('0x2f')],{'balance':new bigNumber(_0x30ab0c[_0x9c7c('0x31')])[_0x9c7c('0x26')](_0x1fc220),'totalSend':new bigNumber(_0x30ab0c[_0x9c7c('0x32')])[_0x9c7c('0x11')](_0x1fc220)},(_0x454321,_0x23891f)=>{_0x35e24a();});});});});});});});}else{LbSocket[_0x9c7c('0x29')](_0x1a9e8f[_0x9c7c('0x2a')],_0x9c7c('0x2b'),{'update':!![]});_0x2d7ba1(_0x1fc220);}};_0x5870e4(_0x39a8f9);},0xf423f,0x0,{'rate':-0x1,'create':-0x1});}[_0x9c7c('0x1a')](_0x288519,_0x135115){Exchange[_0x9c7c('0x24')]({'success':![],'cancel':![],'market':_0x9c7c('0xf'),'type':'S','$or':[{'rate':_0x288519[_0x9c7c('0x14')]},{'rate':{'$lte':_0x288519[_0x9c7c('0x14')]}}]},(_0x6db6fb,_0x48d2cf)=>{let _0x266d0a=0x0;let _0x50edc1=_0x2ec7ed=>{if(_0x2ec7ed&&_0x2ec7ed[_0x9c7c('0x25')]&&_0x266d0a<_0x288519[_0x9c7c('0x16')]){let _0x185450=_[_0x9c7c('0x33')](_0x2ec7ed);let _0x59c99a=()=>{_0x50edc1(_[_0x9c7c('0x34')](_0x2ec7ed));};let _0x2555d6=Math[_0x9c7c('0x35')](new bigNumber(_0x288519[_0x9c7c('0x16')])[_0x9c7c('0x26')](_0x266d0a)[_0x9c7c('0x17')](),_0x185450[_0x9c7c('0x16')]);this[_0x9c7c('0x28')](_0x288519,_0x2555d6,()=>{if(this[_0x9c7c('0xd')][_0x9c7c('0x18')][_0x288519['rate']]){this['listExchange'][_0x9c7c('0x18')][_0x288519[_0x9c7c('0x14')]][_0x9c7c('0x15')]=new bigNumber(this[_0x9c7c('0xd')][_0x9c7c('0x18')][_0x288519[_0x9c7c('0x14')]][_0x9c7c('0x15')])[_0x9c7c('0x26')](_0x2555d6);this[_0x9c7c('0x22')](_0x288519);}this[_0x9c7c('0x27')](_0x185450,_0x2555d6,()=>{if(this[_0x9c7c('0xd')][_0x9c7c('0x13')][_0x185450[_0x9c7c('0x14')]]){this[_0x9c7c('0xd')][_0x9c7c('0x13')][_0x185450['rate']][_0x9c7c('0x15')]=new bigNumber(this[_0x9c7c('0xd')][_0x9c7c('0x13')][_0x185450[_0x9c7c('0x14')]]['amount'])[_0x9c7c('0x26')](_0x2555d6);this[_0x9c7c('0x22')](_0x185450);}LbSocket['sendToMember'](_0x185450['member'],'do-update-info',{'update':!![]});_0x266d0a=new bigNumber(_0x2555d6)['plus'](_0x266d0a)[_0x9c7c('0x17')]();WalletAddress[_0x9c7c('0x2c')]({'member':_0x288519['member']},(_0x353781,_0x294ad6)=>{WalletAddress[_0x9c7c('0x2c')]({'member':_0x185450['member']},(_0x351af2,_0x2c88c8)=>{Tx['create']({'from':_0x2c88c8[_0x9c7c('0x2d')],'to':_0x294ad6[_0x9c7c('0x2d')],'amount':_0x266d0a,'status':0x1},()=>{WalletAddress[_0x9c7c('0x2e')](_0x294ad6[_0x9c7c('0x2f')],{'balance':new bigNumber(_0x294ad6[_0x9c7c('0x31')])[_0x9c7c('0x11')](_0x266d0a),'totalReceived':new bigNumber(_0x294ad6[_0x9c7c('0x30')])['plus'](_0x266d0a)},(_0x3fd9e6,_0x14bad4)=>{WalletAddress[_0x9c7c('0x2e')](_0x2c88c8['_id'],{'balance':new bigNumber(_0x2c88c8['balance'])[_0x9c7c('0x26')](_0x266d0a),'totalSend':new bigNumber(_0x2c88c8[_0x9c7c('0x32')])['plus'](_0x266d0a)},(_0xffe3e1,_0x34f04d)=>{_0x59c99a();});});});});});});});}else{LbSocket[_0x9c7c('0x29')](_0x288519[_0x9c7c('0x2a')],'do-update-info',{'update':!![]});_0x135115(_0x266d0a);}};_0x50edc1(_0x48d2cf);},0xf423f,0x0,{'rate':0x1,'create':-0x1});}['__IniBuyAction'](_0x5b4fb6,_0xf99f4,_0x2509dd){Exchange[_0x9c7c('0x2e')](_0x5b4fb6['_id'],{'totalRemaining':new bigNumber(_0x5b4fb6['totalRemaining'])[_0x9c7c('0x26')](_0xf99f4)[_0x9c7c('0x17')](),'successDate':new Date(),'success':new bigNumber(_0x5b4fb6[_0x9c7c('0x16')])[_0x9c7c('0x26')](_0xf99f4)['valueOf']()<=0x0?!![]:![]},()=>{Member['findById'](_0x5b4fb6[_0x9c7c('0x2a')],(_0x34dba9,_0x1a45a4)=>{if(_0x1a45a4){LbSocket['sendToMember'](_0x1a45a4[_0x9c7c('0x2f')],_0x9c7c('0x36'),{'update':!![]});MemberBalance[_0x9c7c('0x37')](_0x1a45a4[_0x9c7c('0x31')],(_0x59dc22,_0x238ae1)=>{MemberBalance[_0x9c7c('0x2e')](_0x238ae1[_0x9c7c('0x2f')],{'coin':new bigNumber(_0x238ae1[_0x9c7c('0x38')])[_0x9c7c('0x11')](_0xf99f4)['valueOf']()},()=>{CoinTransaction[_0x9c7c('0x1c')]({'member':_0x1a45a4[_0x9c7c('0x2f')],'address':_0x1a45a4['coinwallet'],'plus':!![],'type':'buy','amount':_0xf99f4,'description':_0x9c7c('0x39')+numeral(_0xf99f4)[_0x9c7c('0x3a')]('0,0.00000000')+_0x9c7c('0x3b')+numeral(_0xf99f4)['format']('0,0.00000000')+_0x9c7c('0x3c')+numeral(_0x5b4fb6[_0x9c7c('0x14')])[_0x9c7c('0x3a')](_0x9c7c('0x3d'))+_0x9c7c('0x3e')+numeral(new bigNumber(_0x5b4fb6['rate'])['times'](_0xf99f4)[_0x9c7c('0x17')]())[_0x9c7c('0x3a')]('0,0.00000000')+_0x9c7c('0x3f')+numeral(new bigNumber(_0x5b4fb6[_0x9c7c('0x14')])[_0x9c7c('0x1e')](_0xf99f4)[_0x9c7c('0x1e')](0.0025)[_0x9c7c('0x17')]())[_0x9c7c('0x3a')](_0x9c7c('0x3d'))},()=>{});MemberStatistics['findById'](_0x1a45a4['statistics'],(_0x57dbb2,_0x5e517b)=>{MemberStatistics[_0x9c7c('0x2e')](_0x5e517b['_id'],{'exchange.buy.amount':new bigNumber(_0x5e517b[_0x9c7c('0x40')][_0x9c7c('0x41')][_0x9c7c('0x15')])['plus'](_0xf99f4)[_0x9c7c('0x17')](),'exchange.buy.BTC':new bigNumber(_0x5e517b['exchange'][_0x9c7c('0x41')][_0x9c7c('0xf')])['plus'](new bigNumber(_0xf99f4)['times'](_0x5b4fb6['rate']))},()=>{WalletTransaction['create']({'address':_0x1a45a4[_0x9c7c('0x42')],'member':_0x1a45a4[_0x9c7c('0x2f')],'type':_0x9c7c('0x43'),'to':_0x9c7c('0x38'),'description':_0x9c7c('0x44'),'amount':_0xf99f4,'foreignKey':_0x5b4fb6['_id']},()=>{_0x2509dd();});});});});});}else{_0x2509dd();}});});}[_0x9c7c('0x27')](_0x5957df,_0x15b9b8,_0x345f3c){Exchange['update'](_0x5957df['_id'],{'totalRemaining':new bigNumber(_0x5957df['totalRemaining'])[_0x9c7c('0x26')](_0x15b9b8)['valueOf'](),'successDate':new Date(),'success':new bigNumber(_0x5957df['totalRemaining'])[_0x9c7c('0x26')](_0x15b9b8)[_0x9c7c('0x17')]()<=0x0?!![]:![]},()=>{Member[_0x9c7c('0x37')](_0x5957df[_0x9c7c('0x2a')],(_0x467e6a,_0xf330ba)=>{if(_0xf330ba){LbSocket['sendToMember'](_0xf330ba['_id'],'do-update-open-orders',{'update':!![]});MemberBalance['findById'](_0xf330ba[_0x9c7c('0x31')],(_0x4dd7d3,_0x1854ac)=>{MemberBalance[_0x9c7c('0x2e')](_0x1854ac['_id'],{'BTC':new bigNumber(_0x1854ac[_0x9c7c('0xf')])['plus'](new bigNumber(_0x15b9b8)[_0x9c7c('0x1e')](_0x5957df[_0x9c7c('0x14')])['times'](new bigNumber(0x1)['minus'](Config[_0x9c7c('0x40')]['fee']))[_0x9c7c('0x17')]())[_0x9c7c('0x17')]()},()=>{MemberStatistics['findById'](_0xf330ba[_0x9c7c('0x45')],(_0x2561ab,_0xd8e8ad)=>{MemberStatistics['update'](_0xd8e8ad[_0x9c7c('0x2f')],{'exchange.sell.amount':new bigNumber(_0xd8e8ad[_0x9c7c('0x40')]['sell'][_0x9c7c('0x15')])['plus'](_0x15b9b8)[_0x9c7c('0x17')](),'exchange.sell.BTC':new bigNumber(_0xd8e8ad[_0x9c7c('0x40')][_0x9c7c('0x46')][_0x9c7c('0xf')])[_0x9c7c('0x11')](new bigNumber(_0x15b9b8)[_0x9c7c('0x1e')](_0x5957df[_0x9c7c('0x14')])['times'](new bigNumber(0x1)[_0x9c7c('0x26')](Config[_0x9c7c('0x40')][_0x9c7c('0x47')]))['valueOf']())},()=>{BtcTransaction[_0x9c7c('0x1c')]({'member':_0xf330ba[_0x9c7c('0x2f')],'type':_0x9c7c('0x48'),'to':_0x9c7c('0xf'),'description':'Exchange:\x20SELL\x20SVC','amount':new bigNumber(_0x15b9b8)['times'](_0x5957df['rate'])[_0x9c7c('0x1e')](new bigNumber(0x1)[_0x9c7c('0x26')](Config[_0x9c7c('0x40')][_0x9c7c('0x47')]))[_0x9c7c('0x17')](),'foreignKey':_0x5957df[_0x9c7c('0x2f')]},()=>{_0x345f3c();});});});});});}else{_0x345f3c();}});});}[_0x9c7c('0x49')](_0x204f76,_0x1a6fde,_0x3919bd){}[_0x9c7c('0x4a')](_0x363d5f){}[_0x9c7c('0x4b')](_0x4ded0c,_0x290573){Member[_0x9c7c('0x37')](_0x4ded0c[_0x9c7c('0x2a')],(_0x3334f1,_0x35a93e)=>{MemberBalance['findById'](_0x35a93e[_0x9c7c('0x31')],(_0x5ba71d,_0x25d9e8)=>{let _0x4897df={};if(_0x4ded0c[_0x9c7c('0x12')]=='S'){_0x4897df[_0x9c7c('0x38')]=new bigNumber(_0x25d9e8['coin'])[_0x9c7c('0x11')](_0x4ded0c['totalRemaining'])[_0x9c7c('0x17')]();WalletTransaction[_0x9c7c('0x1c')]({'address':_0x35a93e[_0x9c7c('0x42')],'member':_0x35a93e[_0x9c7c('0x2f')],'type':_0x9c7c('0x4c'),'description':_0x9c7c('0x4d'),'amount':_0x4ded0c[_0x9c7c('0x16')],'foreignKey':_0x4ded0c[_0x9c7c('0x2f')]},()=>{});CoinTransaction[_0x9c7c('0x1c')]({'member':_0x35a93e[_0x9c7c('0x2f')],'address':_0x35a93e[_0x9c7c('0x42')],'plus':!![],'type':_0x9c7c('0x4e'),'amount':_0x4ded0c[_0x9c7c('0x16')],'description':_0x9c7c('0x4f')+numeral(_0x4ded0c[_0x9c7c('0x50')])[_0x9c7c('0x3a')](_0x9c7c('0x3d'))+_0x9c7c('0x3b')+numeral(_0x4ded0c[_0x9c7c('0x16')])['format'](_0x9c7c('0x3d'))+',\x20PRICE:\x20'+numeral(_0x4ded0c[_0x9c7c('0x14')])[_0x9c7c('0x3a')](_0x9c7c('0x3d'))+_0x9c7c('0x3e')+numeral(new bigNumber(_0x4ded0c[_0x9c7c('0x14')])[_0x9c7c('0x1e')](_0x4ded0c[_0x9c7c('0x16')])[_0x9c7c('0x17')]())[_0x9c7c('0x3a')](_0x9c7c('0x3d'))+_0x9c7c('0x3f')+numeral(new bigNumber(_0x4ded0c[_0x9c7c('0x14')])['times'](_0x4ded0c['totalRemaining'])[_0x9c7c('0x1e')](0.0025)[_0x9c7c('0x17')]())['format']('0,0.00000000')},()=>{});if(this['listExchange'][_0x9c7c('0x13')][_0x4ded0c[_0x9c7c('0x14')]]){this[_0x9c7c('0xd')][_0x9c7c('0x13')][_0x4ded0c[_0x9c7c('0x14')]][_0x9c7c('0x15')]=new bigNumber(this['listExchange'][_0x9c7c('0x13')][_0x4ded0c[_0x9c7c('0x14')]][_0x9c7c('0x15')])['minus'](_0x4ded0c[_0x9c7c('0x16')]);this[_0x9c7c('0x22')](_0x4ded0c);}}else{_0x4897df[_0x9c7c('0xf')]=new bigNumber(_0x25d9e8[_0x9c7c('0xf')])[_0x9c7c('0x11')](new bigNumber(_0x4ded0c[_0x9c7c('0x16')])[_0x9c7c('0x1e')](_0x4ded0c[_0x9c7c('0x14')])['times'](new bigNumber(0x1)['plus'](Config[_0x9c7c('0x40')][_0x9c7c('0x47')])))[_0x9c7c('0x17')]();BtcTransaction[_0x9c7c('0x1c')]({'member':_0x35a93e[_0x9c7c('0x2f')],'type':'exchange_buy_coin_cancel','to':_0x9c7c('0xf'),'description':_0x9c7c('0x51'),'amount':new bigNumber(_0x4ded0c[_0x9c7c('0x16')])[_0x9c7c('0x1e')](_0x4ded0c[_0x9c7c('0x14')])['times'](new bigNumber(0x1)[_0x9c7c('0x11')](Config[_0x9c7c('0x40')][_0x9c7c('0x47')])),'foreignKey':_0x4ded0c[_0x9c7c('0x2f')]},()=>{});if(this[_0x9c7c('0xd')]['Buys'][_0x4ded0c[_0x9c7c('0x14')]]){this[_0x9c7c('0xd')][_0x9c7c('0x18')][_0x4ded0c[_0x9c7c('0x14')]][_0x9c7c('0x15')]=new bigNumber(this[_0x9c7c('0xd')][_0x9c7c('0x18')][_0x4ded0c[_0x9c7c('0x14')]][_0x9c7c('0x15')])[_0x9c7c('0x26')](_0x4ded0c[_0x9c7c('0x16')]);this[_0x9c7c('0x22')](_0x4ded0c);}}MemberBalance[_0x9c7c('0x2e')](_0x35a93e[_0x9c7c('0x31')],_0x4897df,()=>{Exchange[_0x9c7c('0x2e')](_0x4ded0c[_0x9c7c('0x2f')],{'cancel':!![],'cancelDate':new Date(),'cancelAmount':_0x4ded0c[_0x9c7c('0x16')]},(_0x15b734,_0x3b0d6e)=>{LbSocket['sendToMember'](_0x35a93e['_id'],_0x9c7c('0x2b'),{'update':!![]});LbSocket['sendToMember'](_0x35a93e[_0x9c7c('0x2f')],_0x9c7c('0x36'),{'update':!![]});});});});});}['createExchange'](_0x31594c,_0x4e6bee,_0xb943df,_0x5b0d33='S',_0x34dab2){MemberBalance[_0x9c7c('0x37')](_0x31594c[_0x9c7c('0x31')],(_0x1e2f0e,_0x48e502)=>{let _0x1c00b6={};if(_0x5b0d33=='S'){_0x1c00b6['coin']=new bigNumber(_0x48e502[_0x9c7c('0x38')])['minus'](_0x4e6bee)['valueOf']();CoinTransaction[_0x9c7c('0x1c')]({'member':_0x31594c[_0x9c7c('0x2f')],'address':_0x31594c[_0x9c7c('0x42')],'plus':![],'type':_0x9c7c('0x46'),'amount':_0x4e6bee,'description':_0x9c7c('0x52')+numeral(_0x4e6bee)[_0x9c7c('0x3a')](_0x9c7c('0x3d'))+',\x20UNITS\x20FILLED\x20SVC:\x20'+numeral(_0x4e6bee)[_0x9c7c('0x3a')](_0x9c7c('0x3d'))+_0x9c7c('0x3c')+numeral(_0xb943df)['format'](_0x9c7c('0x3d'))+_0x9c7c('0x3e')+numeral(new bigNumber(_0xb943df)[_0x9c7c('0x1e')](_0x4e6bee)[_0x9c7c('0x17')]())[_0x9c7c('0x3a')](_0x9c7c('0x3d'))+',\x20FEES\x20BTC:\x20'+numeral(new bigNumber(_0xb943df)[_0x9c7c('0x1e')](_0x4e6bee)[_0x9c7c('0x1e')](0.0025)[_0x9c7c('0x17')]())[_0x9c7c('0x3a')](_0x9c7c('0x3d'))},()=>{});}else{_0x1c00b6[_0x9c7c('0xf')]=new bigNumber(_0x48e502[_0x9c7c('0xf')])['minus'](new bigNumber(_0x4e6bee)[_0x9c7c('0x1e')](_0xb943df)[_0x9c7c('0x1e')](new bigNumber(0x1)[_0x9c7c('0x11')](Config['exchange'][_0x9c7c('0x47')])))[_0x9c7c('0x17')]();}MemberBalance[_0x9c7c('0x2e')](_0x31594c['balance'],_0x1c00b6,()=>{Exchange[_0x9c7c('0x1c')]({'type':_0x5b0d33=='S'?'S':'B','member':_0x31594c[_0x9c7c('0x2f')],'totalAmount':_0x4e6bee,'totalRemaining':_0x4e6bee,'rate':_0xb943df,'market':'BTC'},(_0x1be84a,_0xc21b7b)=>{LbSocket[_0x9c7c('0x29')](_0xc21b7b[_0x9c7c('0x2a')],_0x9c7c('0x36'),{'update':!![]});LbSocket[_0x9c7c('0x29')](_0xc21b7b[_0x9c7c('0x2a')],_0x9c7c('0x2b'),{'update':!![]});if(_0x5b0d33=='B'){BtcTransaction[_0x9c7c('0x1c')]({'member':_0x31594c[_0x9c7c('0x2f')],'type':_0x9c7c('0x53'),'to':'coin','description':_0x9c7c('0x54'),'amount':new bigNumber(_0x4e6bee)[_0x9c7c('0x1e')](_0xb943df)[_0x9c7c('0x1e')](new bigNumber(0x1)[_0x9c7c('0x11')](Config[_0x9c7c('0x40')][_0x9c7c('0x47')]))[_0x9c7c('0x1e')](-0x1)['valueOf'](),'foreignKey':_0xc21b7b[_0x9c7c('0x2f')]},()=>{});}else{WalletTransaction['create']({'address':_0x31594c[_0x9c7c('0x42')],'member':_0x31594c[_0x9c7c('0x2f')],'type':_0x9c7c('0x55'),'description':_0x9c7c('0x56'),'amount':_0x4e6bee*-0x1,'foreignKey':_0xc21b7b[_0x9c7c('0x2f')]},()=>{});}this[_0x9c7c('0x11')](_0xc21b7b,!![]);_0x34dab2();});});});}}module[_0x9c7c('0x57')]=new LbExchange();