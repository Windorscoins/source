var _0xfa7f=['./../config/config','moment-timezone','./../models/CoinConfig','sendExchange10m','emit','exchangeChartData','10m','Ticker','getTicker','addMemberSocket','getAddress','listMember','listSocket','sendAllTicker','ticker','pick','BTC','ETH','RemoveConnect','MemberId','length','socket','request','connection','remoteAddress','replace','_peername','port','updateWalletTransaction','updateConfig','day','valueOf','GetValue','findOne','findAllQ','auto_withdraw_comfirm','qty','sold','price','max','date','updateICOConfig','omit','exports','underscore'];(function(_0x460385,_0x3e9fcc){var _0x7fd23e=function(_0x447656){while(--_0x447656){_0x460385['push'](_0x460385['shift']());}};_0x7fd23e(++_0x3e9fcc);}(_0xfa7f,0x194));var _0xffa7=function(_0x24aef5,_0x250cb1){_0x24aef5=_0x24aef5-0x0;var _0x53e536=_0xfa7f[_0x24aef5];return _0x53e536;};'use strict';const _=require(_0xffa7('0x0'));const Config=require(_0xffa7('0x1'));const moment=require(_0xffa7('0x2'));const SysConfig=require('./../models/SysConfig');const CoinConfig=require(_0xffa7('0x3'));class LbSocket{constructor(){this['listMember']={};this['listSocket']={};}[_0xffa7('0x4')](_0xcfcf82){this['io'][_0xffa7('0x5')](_0xffa7('0x6'),{'type':_0xffa7('0x7'),'data':_0xcfcf82});}[_0xffa7('0x8')](_0x424859){this[_0xffa7('0x9')](_0x1e65ce=>{_0x424859(_0x1e65ce);});}[_0xffa7('0xa')](_0x4cadcc,_0x11bb3c){let _0x2dae07=this[_0xffa7('0xb')](_0x4cadcc);let _0x208e0a=String(_0x11bb3c['_id']);if(!this[_0xffa7('0xc')][_0x208e0a]){this[_0xffa7('0xc')][_0x208e0a]={};}this[_0xffa7('0xc')][_0x208e0a][_0x2dae07['id']]=new Date()['getTime']();this[_0xffa7('0xd')][_0x2dae07['id']]={'socket':_0x4cadcc,'MemberId':_0x208e0a,'member':_0x11bb3c};}[_0xffa7('0xe')](_0xb3ab2a){this['io']['emit'](_0xffa7('0xf'),_[_0xffa7('0x10')](_0xb3ab2a,_0xffa7('0x11'),'ETH'));}['AddConnect'](_0x5379e3){this[_0xffa7('0x9')](_0x4f375d=>{_0x5379e3[_0xffa7('0x5')](_0xffa7('0xf'),_['pick'](_0x4f375d,_0xffa7('0x11'),_0xffa7('0x12')));});}[_0xffa7('0x13')](_0x183198){let _0x3b02d6=this['getAddress'](_0x183198);if(this[_0xffa7('0xd')][_0x3b02d6['id']]){delete this[_0xffa7('0xc')][this['listSocket'][_0x3b02d6['id']][_0xffa7('0x14')]][_0x3b02d6['id']];if(Object['keys'](this[_0xffa7('0xc')][this['listSocket'][_0x3b02d6['id']][_0xffa7('0x14')]])[_0xffa7('0x15')]==0x0){delete this['listMember'][this['listSocket'][_0x3b02d6['id']][_0xffa7('0x14')]];}delete this['listSocket'][_0x3b02d6['id']];}}['sendToMember'](_0x170925,_0x50556e,_0x370ae5){let _0x147cf8=String(_0x170925);if(this[_0xffa7('0xc')][_0x147cf8]){for(let _0xd27df9 in this[_0xffa7('0xc')][_0x147cf8]){if(this['listSocket'][_0xd27df9][_0xffa7('0x16')]&&this[_0xffa7('0xd')][_0xd27df9]['socket'][_0xffa7('0x5')]){try{this[_0xffa7('0xd')][_0xd27df9]['socket'][_0xffa7('0x5')](_0x50556e,_0x370ae5);}catch(_0x3cf974){}}}}}['getAddress'](_0xa36ed9){return{'address':String(_0xa36ed9[_0xffa7('0x17')][_0xffa7('0x18')][_0xffa7('0x19')])[_0xffa7('0x1a')]('::ffff:',''),'port':_0xa36ed9[_0xffa7('0x17')]['connection'][_0xffa7('0x1b')][_0xffa7('0x1c')],'remote':String(_0xa36ed9[_0xffa7('0x17')][_0xffa7('0x18')][_0xffa7('0x19')])[_0xffa7('0x1a')]('::ffff:','')+':'+_0xa36ed9[_0xffa7('0x17')][_0xffa7('0x18')]['_peername'][_0xffa7('0x1c')],'id':_0xa36ed9['id']};}['updateWalletTransaction'](){this['io'][_0xffa7('0x5')](_0xffa7('0x1d'),{'update':!![]});}[_0xffa7('0x1e')](){let _0xcd8304=moment()['tz'](Config['time'])['startOf'](_0xffa7('0x1f'))[_0xffa7('0x20')]();SysConfig[_0xffa7('0x21')](_0x39d816=>{CoinConfig[_0xffa7('0x22')]({'date':new Date(_0xcd8304)},(_0x478ee9,_0x54b4c0)=>{if(!_0x54b4c0){CoinConfig[_0xffa7('0x23')]({'date':{'$gte':new Date(_0xcd8304)}},(_0x297ece,_0x45252f)=>{let _0x75fe8c={'sysConfig':_['omit'](_0x39d816,_0xffa7('0x24')),'coinConfig':_[_0xffa7('0x10')](_0x54b4c0,_0xffa7('0x25'),_0xffa7('0x26'),'price','max','date'),'nextCoinConfig':_[_0xffa7('0x10')](_0x45252f?_0x45252f[0x0]:{},_0xffa7('0x25'),'sold',_0xffa7('0x27'),_0xffa7('0x28'),_0xffa7('0x29'))};this['io'][_0xffa7('0x5')](_0xffa7('0x2a'),_0x75fe8c);},0x1,0x1,{'date':0x1});}else{let _0x3aa409={'sysConfig':_[_0xffa7('0x2b')](_0x39d816,'auto_withdraw_comfirm'),'coinConfig':_[_0xffa7('0x10')](_0x54b4c0,_0xffa7('0x25'),_0xffa7('0x26'),'price',_0xffa7('0x28'),_0xffa7('0x29'))};this['io'][_0xffa7('0x5')](_0xffa7('0x2a'),_0x3aa409);}});});}}module[_0xffa7('0x2c')]=new LbSocket();