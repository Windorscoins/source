var _0x175e=['notEmpty','twoFactorToken','tokenNotValid','asyncValidationErrors','body','jwt','username','password','update','_id','member','jsonToken','json','catch','post','checkBody','usernameRequired','passwordRequired','then','findOne','active','twoFactorActive','sign','usernamePasswordNotValid','verifyEmailBeforeLogin','exports','router','jsonwebtoken','./../../../../config/config','index','put','token','Token\x20is\x20required'];(function(_0x3188a0,_0xf6d0fb){var _0x40e7f5=function(_0x40b2c6){while(--_0x40b2c6){_0x3188a0['push'](_0x3188a0['shift']());}};_0x40e7f5(++_0xf6d0fb);}(_0x175e,0x102));var _0xe175=function(_0x2d9c73,_0x3721af){_0x2d9c73=_0x2d9c73-0x0;var _0x5f1434=_0x175e[_0x2d9c73];return _0x5f1434;};'use strict';const Core=require('./../../../../core/core');const JWT=require(_0xe175('0x0'));const Config=require(_0xe175('0x1'));const Member=require('./../../../../models/Member');class DefaultAuthLogin extends Core{constructor(){super();this[_0xe175('0x2')]();}['index'](){this[_0xe175('0x3')]('/',(_0x3ec692,_0x193501)=>{_0x3ec692['checkBody'](_0xe175('0x4'),_0xe175('0x5'))[_0xe175('0x6')]()[_0xe175('0x7')](_0x3ec692['body']['twoFactor'])['withMessage'](__(_0xe175('0x8')));_0x3ec692[_0xe175('0x9')]()['then'](()=>{JWT['verify'](_0x3ec692[_0xe175('0xa')][_0xe175('0x4')],Config[_0xe175('0xb')],(_0x5c15d5,_0x5be2fa)=>{if(_0x5be2fa&&_0x5be2fa[_0xe175('0xc')]){Member['findByUser'](_0x5be2fa['username'],(_0x1fda2c,_0x12d524)=>{JWT['verify'](_0x12d524[_0xe175('0xd')],Config[_0xe175('0xb')],(_0x574e9e,_0x2ea3b0)=>{Member[_0xe175('0xe')](_0x12d524[_0xe175('0xf')],{'active':!![]},()=>{_0x3ec692[_0xe175('0x10')]=_0x12d524;this[_0xe175('0x11')](_0x3ec692,_0x193501);});});});}else{_0x193501[_0xe175('0x12')]({'status':![],'msg':__(_0xe175('0x8'))});}});})[_0xe175('0x13')](_0x2dfd6b=>{_0x193501[_0xe175('0x12')]({'status':![],'err':_0x2dfd6b});});});this[_0xe175('0x14')]('/',(_0x549864,_0x200029)=>{_0x549864[_0xe175('0x15')](_0xe175('0xc'),__(_0xe175('0x16')))['notEmpty']();_0x549864[_0xe175('0x15')](_0xe175('0xd'),__(_0xe175('0x17')))['notEmpty']();_0x549864[_0xe175('0x9')]()[_0xe175('0x18')](()=>{Member[_0xe175('0x19')]({'username':_0x549864[_0xe175('0xa')]['username']},(_0xc5f09c,_0x5bab1d)=>{if(_0x5bab1d&&_0x5bab1d[_0xe175('0x1a')]){JWT['verify'](_0x5bab1d[_0xe175('0xd')],Config[_0xe175('0xb')],(_0x42b8e9,_0x21a0fb)=>{if(_0x21a0fb&&_0x21a0fb['password']&&_0x21a0fb[_0xe175('0xd')]==_0x549864[_0xe175('0xa')]['password']){if(!_0x5bab1d[_0xe175('0x1b')]){_0x549864[_0xe175('0x10')]=_0x5bab1d;this['jsonToken'](_0x549864,_0x200029);}else{_0x200029['json']({'status':!![],'action':'twoFactorAuthenticator','token':JWT[_0xe175('0x1c')]({'username':_0x5bab1d[_0xe175('0xc')]},Config['jwt'])});}}else{_0x200029[_0xe175('0x12')]({'status':![],'msg':__(_0xe175('0x1d'))});}});}else if(_0x5bab1d){_0x200029[_0xe175('0x12')]({'status':![],'msg':__(_0xe175('0x1e'))});}else{_0x200029[_0xe175('0x12')]({'status':![],'msg':__(_0xe175('0x1d'))});}});})[_0xe175('0x13')](_0xff9e8d=>{_0x200029[_0xe175('0x12')]({'status':![],'err':_0xff9e8d});});});}}module[_0xe175('0x1f')]=new DefaultAuthLogin()[_0xe175('0x20')];